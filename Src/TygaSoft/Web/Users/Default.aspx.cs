using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Web.UI;
using System.Web.UI.WebControls;
using System.Web.Security;
using System.Threading.Tasks;
using Newtonsoft.Json;
using TygaSoft.CustomProvider;
using TygaSoft.Model;
using TygaSoft.BLL;
using TygaSoft.WebHelper;

namespace TygaSoft.Web.Users
{
    public partial class Default : System.Web.UI.Page
    {
        protected void Page_Load(object sender, EventArgs e)
        {
            if (!Page.IsPostBack)
            {
                //var t1 = Task.Factory.StartNew(() =>
                //{
                //    string[] userRoles = Roles.GetRolesForUser();
                //    CustomProfileCommon profile = new CustomProfileCommon();
                //    var menuBll = new Menus();
                //    var userMenuAccessList = menuBll.GetUserMenuAccessList(WebCommon.GetUserId(), userRoles);

                //    profile.MobilePhone = "18308909011";
                //    profile.UserMenus = JsonConvert.SerializeObject(userMenuAccessList);
                //    profile.Save();
                //});

                //t1.Wait();

                //AuthenticationServiceClient authService = new AuthenticationServiceClient();
                //bool isLogin = authService.IsLoggedIn();

                //RoleServiceClient roleService = new RoleServiceClient();
                //var roleArr = roleService.GetRolesForCurrentUser();

                //var userRoles = Roles.GetRolesForUser(userName);
                //var userId = Membership.GetUser(userName).ProviderUserKey;
                //var menuBll = new Menus();
                //var userMenuAccessList = menuBll.GetUserMenuAccessList(userId, userRoles);

                //ProfileServiceClient profile = new ProfileServiceClient();
                //var dic = new Dictionary<string, object>();
                ////dic.Add("UserMenus", JsonConvert.SerializeObject(userMenuAccessList));
                //dic.Add("MobilePhone", "18308909020");
                //profile.SetPropertiesForCurrentUser(dic, false);

                //ProfileServiceClient profile = new ProfileServiceClient();
                //string[] proArr = { "MobilePhone", "UserMenus" };
                //var userMenus = profile.GetPropertiesForCurrentUser(proArr, false);

                //CustomProfileCommon profile = new CustomProfileCommon();
                //var mobilePhone = profile.MobilePhone;
                //var sUserMenu = profile.UserMenus;
                //List<MenusInfo> userMenuList = null;
                //if (!string.IsNullOrEmpty(sUserMenu)) userMenuList = JsonConvert.DeserializeObject<List<MenusInfo>>(sUserMenu);
            }
            //Response.Redirect("/wms/u/y.html");
        }
    }
}